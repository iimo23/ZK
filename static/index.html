<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZK Attendance System</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#" id="brand-link">
                <i class="bi bi-fingerprint"></i> ZK Attendance System
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item" id="connection-status-container">
                        <span class="nav-link">
                            <span class="connection-status disconnected">
                                <i class="bi bi-exclamation-triangle"></i> Not Connected
                            </span>
                        </span>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 d-none d-md-block sidebar">
                <div class="position-sticky">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="/dashboard" onclick="return navigateTo('dashboard')">
                                <i class="bi bi-speedometer2"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/api_send" onclick="return navigateTo('api_send')">
                                <i class="bi bi-cloud-upload"></i> Send Data
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/settings" onclick="return navigateTo('settings')">
                                <i class="bi bi-gear"></i> Settings
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/connect" onclick="return navigateTo('connect')">
                                <i class="bi bi-plug"></i> Connect Device
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Main Content -->
            <main class="col-md-10 ms-sm-auto content">
                <div id="notification-container" class="notification"></div>
                <div id="page-container" class="page">
                    <!-- Page content will be loaded here -->
                </div>
            </main>
        </div>
    </div>

    <!-- Page Templates -->
    <template id="connect-template">
        <div class="container mt-4">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="card shadow-sm">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">Connect to ZK Device</h5>
                        </div>
                        <div class="card-body">
                            <form id="connect-form">
                                <div class="mb-3">
                                    <label for="device-ip" class="form-label">Device IP Address</label>
                                    <input type="text" class="form-control" id="device-ip" placeholder="192.168.1.201" required>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="device-port" class="form-label">Port</label>
                                        <input type="number" class="form-control" id="device-port" value="4370" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="device-timeout" class="form-label">Timeout (seconds)</label>
                                        <input type="number" class="form-control" id="device-timeout" value="5" required>
                                    </div>
                                </div>
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-primary" id="connect-button">
                                        <i class="bi bi-plug"></i> Connect
                                    </button>
                                </div>
                            </form>
                            <div id="connect-result" class="mt-3"></div>
                        </div>
                    </div>
                    <div class="card mt-4 shadow-sm">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">Connection Guide</h5>
                        </div>
                        <div class="card-body">
                            <p>To connect to your ZK device:</p>
                            <ol>
                                <li>Make sure the device is powered on and connected to the network</li>
                                <li>Enter the IP address of the device</li>
                                <li>Use the default port (4370) unless your device uses a different port</li>
                                <li>Click the Connect button</li>
                            </ol>
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle"></i> If you don't know the IP address of your device, check your router's connected devices list or use a network scanner.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>
    
    <template id="dashboard-template">
        <div class="container mt-4">
            <!-- Device Connection Alert -->
            <div id="device-alert" class="row mb-4 d-none">
                <div class="col-12">
                    <div class="alert alert-warning shadow-sm">
                        <div class="d-flex align-items-center">
                            <div class="flex-shrink-0">
                                <i class="bi bi-exclamation-triangle-fill fs-3 me-3"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h5 class="alert-heading">No Device Connected</h5>
                                <p class="mb-0">Connect to your ZK device to start using the system.</p>
                            </div>
                            <div class="flex-shrink-0">
                                <a href="#connect" data-page="connect" class="btn btn-warning">
                                    <i class="bi bi-plug"></i> Connect Device
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="row mb-4">
                <div class="col-md-6 mb-4 mb-md-0">
                    <div class="card stats-card h-100 shadow-sm">
                        <div class="card-body position-relative">
                            <div class="stat-label">Device Status</div>
                            <div class="stat-value" id="device-status">Not Connected</div>
                            <div class="icon text-danger" id="device-status-icon">
                                <i class="bi bi-hdd-network"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card stats-card h-100 shadow-sm">
                        <div class="card-body position-relative">
                            <div class="stat-label">Today's Records</div>
                            <div class="stat-value" id="today-attendance">-</div>
                            <div class="icon text-primary">
                                <i class="bi bi-calendar-check-fill"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Device Info -->
            <div id="device-info-card" class="row mb-4 d-none">
                <div class="col-12">
                    <div class="card shadow-sm">
                        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Device Information</h5>
                            <button id="refresh-device" class="btn btn-sm btn-light">
                                <i class="bi bi-arrow-clockwise"></i> Refresh
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Device IP:</label>
                                        <span id="device-ip-display">-</span>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Port:</label>
                                        <span id="device-port-display">-</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Serial Number:</label>
                                        <span id="device-serial">-</span>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Last Sync:</label>
                                        <span id="last-sync-time">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Recent Activity</h5>
                        <button id="refresh-activity" class="btn btn-sm btn-light">
                            <i class="bi bi-arrow-clockwise"></i> Refresh
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>User ID</th>
                                        <th>Name</th>
                                        <th>Date & Time</th>
                                        <th>Punch Type</th>
                                    </tr>
                                </thead>
                                <tbody id="activity-table">
                                    <!-- Activity data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div id="activity-loading" class="text-center py-3 d-none">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Loading activity data...</p>
                        </div>
                        
                        <div id="no-activity" class="text-center py-3 d-none">
                            <i class="bi bi-exclamation-circle text-warning fs-1"></i>
                            <p class="mt-2">No recent activity found.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="api-send-template">
        <div class="container mt-4">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Send Attendance Data to API</h5>
                            <span id="connection-badge" class="badge bg-danger">Not Connected</span>
                        </div>
                        <div class="card-body">
                            <form id="send-data-form">
                                <div class="mb-4">
                                    <label class="form-label fw-bold">Select Date Range</label>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="start-date" class="form-label">Start Date</label>
                                            <input type="date" class="form-control" id="start-date" name="start_date" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="end-date" class="form-label">End Date</label>
                                            <input type="date" class="form-control" id="end-date" name="end_date" required>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle me-2"></i>
                                    Data will be sent to the API URL configured in the <a href="#settings" data-page="settings">Settings</a> page.
                                </div>
                                
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-primary" id="send-btn">
                                        <i class="bi bi-cloud-upload"></i> Send to API
                                    </button>
                                </div>
                            </form>
                            
                            <div id="send-result" class="mt-4"></div>
                        </div>
                    </div>
                    
                    <div class="card shadow-sm">
                        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Data Preview</h5>
                            <button id="refresh-preview-btn" class="btn btn-sm btn-light">
                                <i class="bi bi-arrow-clockwise"></i> Refresh
                            </button>
                        </div>
                        <div class="card-body">
                            <div id="preview-loading" class="text-center py-3 d-none">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2">Loading data preview...</p>
                            </div>
                            
                            <div id="preview-content" class="d-none">
                                <div class="mb-3">
                                    <h6 class="mb-0">Records to be sent: <span id="record-count" class="badge bg-primary">0</span></h6>
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th>User ID</th>
                                                <th>Date & Time</th>
                                                <th>Punch Type</th>
                                            </tr>
                                        </thead>
                                        <tbody id="preview-table">
                                            <!-- Preview data will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <div id="no-data" class="text-center py-3">
                                <i class="bi bi-exclamation-circle text-warning fs-1"></i>
                                <p class="mt-2">No data to preview. Please select a date range and click "Refresh".</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-5">
                    <div class="card shadow-sm">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">API Information</h5>
                        </div>
                        <div class="card-body">
                            <p>This feature allows you to send attendance data from your ZK device to an external API endpoint.</p>
                            <p>The data will be sent in the following format:</p>
                            <pre class="bg-light p-3 rounded"><code>{
  "data": [
    {
      "emp_no": 12345,
      "device_id": "FHGI9983",
      "punch_type": "1",
      "punch_date": "2025-04-13",
      "punch_time": "2025-04-13 09:30:45"
    },
    ...
  ]
}</code></pre>
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle"></i> The API endpoint should accept POST requests with JSON data.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- App JS -->
    <script src="/static/js/simple-app.js"></script>
</body>
</html>
